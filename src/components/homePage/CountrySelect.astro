---
import { Icon } from "astro-icon";
import { countriesNames } from "../../data/talksData";
import { getIconByCountry } from "../../libs/icons";
---

<div class="flex w-full justify-center relative p-2">
  <div class="flex cursor-pointer clicker">
    <Icon name="fontisto:world-o" class="w-8" />
    <span class="place-self-center ml-2">Display All</span>
  </div>
  <div class="absolute rounded-xl bg-white shadow-lg top-full hiddendiv">
    <ul class="px-2 cursor-pointer py-2" id="country-selector">
      {
        countriesNames.map((country) => (
          <li class="flex justify-left hover:bg-gray-50" data-country={country}>
            <Icon name={getIconByCountry(country)} class="w-12" />
            <span class="ml-1 place-self-center">{country}</span>
          </li>
        ))
      }
    </ul>
  </div>
</div>

<script>
  const countrySelector = document.querySelector("#country-selector");

  const getPaddingTop = (element: any) => {
    const styles = window.getComputedStyle(element);
    const paddingTop = parseInt(styles.paddingTop, 10);
    return paddingTop;
  };

  const getLiInSameLineOfClick = (event: any) => {
    const liHeight = document.querySelector("#country-selector li")?.clientHeight || 1;
    const ul = event.target;
    const ulPaddingTop = getPaddingTop(ul);
    const yReal = event.clientY - ul.getBoundingClientRect().top;
    const yRelativeToInitialOption = yReal - ulPaddingTop;
    const li = ul.querySelector(
      `li:nth-child(${Math.floor(yRelativeToInitialOption / liHeight) + 1})`
    );
    return yRelativeToInitialOption < 0 ? null : li;
  };

  const getClickedLi = (event: Event) => {
    if (event.target instanceof Element && event.target.closest("li")) {
      return event.target?.closest("li");
    }
    return getLiInSameLineOfClick(event);
  };

  countrySelector?.addEventListener("click", (event) => {
    const countryElement = getClickedLi(event);
    if (countryElement) {
      const country = countryElement.dataset.country;
      console.log(country);
    }
  });
</script>
